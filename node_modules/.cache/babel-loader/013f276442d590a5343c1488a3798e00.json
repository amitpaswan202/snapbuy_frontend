{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/PC/Desktop/ffff/snapbuy/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/PC/Desktop/ffff/snapbuy/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{Fragment,useEffect}from'react';import MetaData from'../layout/MetaData';import CheckoutSteps from'./CheckoutSteps';import{useAlert}from'react-alert';import{useDispatch,useSelector}from'react-redux';import{createOrder,clearErrors}from'../../actions/orderActions';import{useStripe,useElements,CardNumberElement,CardExpiryElement,CardCvcElement}from'@stripe/react-stripe-js';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var options={style:{base:{fontSize:'16px'},invalid:{color:'#9e2146'}}};var Payment=function Payment(_ref){var history=_ref.history;var alert=useAlert();var stripe=useStripe();var elements=useElements();var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.auth;}),user=_useSelector.user;var _useSelector2=useSelector(function(state){return state.cart;}),cartItems=_useSelector2.cartItems,shippingInfo=_useSelector2.shippingInfo;var _useSelector3=useSelector(function(state){return state.newOrder;}),error=_useSelector3.error;useEffect(function(){if(error){alert.error(error);dispatch(clearErrors());}},[dispatch,alert,error]);var order={orderItems:cartItems,shippingInfo:shippingInfo};var orderInfo=JSON.parse(sessionStorage.getItem('orderInfo'));if(orderInfo){order.itemsPrice=orderInfo.itemsPrice;order.shippingPrice=orderInfo.shippingPrice;order.taxPrice=orderInfo.taxPrice;order.totalPrice=orderInfo.totalPrice;}var paymentData={amount:Math.round(orderInfo.totalPrice*100)};var submitHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var res,config,clientSecret,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();document.querySelector('#pay_btn').disabled=true;_context.prev=2;config={headers:{'Content-Type':'application/json'}};_context.next=6;return axios.post('/api/v1/payment/process',paymentData,config);case 6:res=_context.sent;clientSecret=res.data.client_secret;console.log(clientSecret);if(!(!stripe||!elements)){_context.next=11;break;}return _context.abrupt(\"return\");case 11:_context.next=13;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardNumberElement),billing_details:{name:user.name,email:user.email}}});case 13:result=_context.sent;if(result.error){alert.error(result.error.message);document.querySelector('#pay_btn').disabled=false;}else{// The payment is processed or not\nif(result.paymentIntent.status==='succeeded'){order.paymentInfo={id:result.paymentIntent.id,status:result.paymentIntent.status};dispatch(createOrder(order));history.push('/success');}else{alert.error('There is some issue while payment processing');}}_context.next=21;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](2);document.querySelector('#pay_btn').disabled=false;alert.error(_context.t0.response.data.message);case 21:case\"end\":return _context.stop();}},_callee,null,[[2,17]]);}));return function submitHandler(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(MetaData,{title:'Payment'}),/*#__PURE__*/_jsx(CheckoutSteps,{shipping:true,confirmOrder:true,payment:true}),/*#__PURE__*/_jsx(\"div\",{className:\"row wrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-10 col-lg-5\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"shadow-lg\",onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-4\",children:\"Card Info\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_num_field\",children:\"Card Number\"}),/*#__PURE__*/_jsx(CardNumberElement,{type:\"text\",id:\"card_num_field\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_exp_field\",children:\"Card Expiry\"}),/*#__PURE__*/_jsx(CardExpiryElement,{type:\"text\",id:\"card_exp_field\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card_cvc_field\",children:\"Card CVC\"}),/*#__PURE__*/_jsx(CardCvcElement,{type:\"text\",id:\"card_cvc_field\",className:\"form-control\",options:options})]}),/*#__PURE__*/_jsxs(\"button\",{id:\"pay_btn\",type:\"submit\",className:\"btn btn-block py-3\",children:[\"Pay \",\" - \".concat(orderInfo&&orderInfo.totalPrice)]})]})})})]});};export default Payment;","map":{"version":3,"names":["React","Fragment","useEffect","MetaData","CheckoutSteps","useAlert","useDispatch","useSelector","createOrder","clearErrors","useStripe","useElements","CardNumberElement","CardExpiryElement","CardCvcElement","axios","jsx","_jsx","jsxs","_jsxs","options","style","base","fontSize","invalid","color","Payment","_ref","history","alert","stripe","elements","dispatch","_useSelector","state","auth","user","_useSelector2","cart","cartItems","shippingInfo","_useSelector3","newOrder","error","order","orderItems","orderInfo","JSON","parse","sessionStorage","getItem","itemsPrice","shippingPrice","taxPrice","totalPrice","paymentData","amount","Math","round","submitHandler","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","res","config","clientSecret","result","wrap","_callee$","_context","prev","next","preventDefault","document","querySelector","disabled","headers","post","sent","data","client_secret","console","log","abrupt","confirmCardPayment","payment_method","card","getElement","billing_details","name","email","message","paymentIntent","status","paymentInfo","id","push","t0","response","stop","_x","apply","arguments","children","title","shipping","confirmOrder","payment","className","onSubmit","htmlFor","type","concat"],"sources":["C:/Users/PC/Desktop/ffff/snapbuy/frontend/src/components/cart/Payment.js"],"sourcesContent":["import React, { Fragment, useEffect } from 'react'\r\n\r\nimport MetaData from '../layout/MetaData'\r\nimport CheckoutSteps from './CheckoutSteps'\r\n\r\nimport { useAlert } from 'react-alert'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { createOrder, clearErrors } from '../../actions/orderActions'\r\n\r\nimport { useStripe, useElements, CardNumberElement, CardExpiryElement, CardCvcElement } from '@stripe/react-stripe-js'\r\n\r\nimport axios from 'axios'\r\n\r\nconst options = {\r\n    style: {\r\n        base: {\r\n            fontSize: '16px'\r\n        },\r\n        invalid: {\r\n            color: '#9e2146'\r\n        }\r\n    }\r\n}\r\n\r\nconst Payment = ({ history }) => {\r\n\r\n    const alert = useAlert();\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const dispatch = useDispatch();\r\n\r\n    const { user } = useSelector(state => state.auth)\r\n    const { cartItems, shippingInfo } = useSelector(state => state.cart);\r\n    const { error } = useSelector(state => state.newOrder)\r\n\r\n    useEffect(() => {\r\n\r\n        if (error) {\r\n            alert.error(error)\r\n            dispatch(clearErrors())\r\n        }\r\n\r\n    }, [dispatch, alert, error])\r\n\r\n    const order = {\r\n        orderItems: cartItems,\r\n        shippingInfo\r\n    }\r\n\r\n    const orderInfo = JSON.parse(sessionStorage.getItem('orderInfo'));\r\n    if (orderInfo) {\r\n        order.itemsPrice = orderInfo.itemsPrice\r\n        order.shippingPrice = orderInfo.shippingPrice\r\n        order.taxPrice = orderInfo.taxPrice\r\n        order.totalPrice = orderInfo.totalPrice\r\n    }\r\n\r\n    const paymentData = {\r\n        amount: Math.round(orderInfo.totalPrice * 100)\r\n    }\r\n\r\n    const submitHandler = async (e) => {\r\n        e.preventDefault();\r\n\r\n        document.querySelector('#pay_btn').disabled = true;\r\n\r\n        let res;\r\n        try {\r\n\r\n            const config = {\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            }\r\n\r\n            res = await axios.post('/api/v1/payment/process', paymentData, config)\r\n\r\n            const clientSecret = res.data.client_secret;\r\n\r\n            console.log(clientSecret);\r\n\r\n            if (!stripe || !elements) {\r\n                return;\r\n            }\r\n\r\n            const result = await stripe.confirmCardPayment(clientSecret, {\r\n                payment_method: {\r\n                    card: elements.getElement(CardNumberElement),\r\n                    billing_details: {\r\n                        name: user.name,\r\n                        email: user.email\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (result.error) {\r\n                alert.error(result.error.message);\r\n                document.querySelector('#pay_btn').disabled = false;\r\n            } else {\r\n\r\n                // The payment is processed or not\r\n                if (result.paymentIntent.status === 'succeeded') {\r\n\r\n                    order.paymentInfo = {\r\n                        id: result.paymentIntent.id,\r\n                        status: result.paymentIntent.status\r\n                    }\r\n\r\n                    dispatch(createOrder(order))\r\n\r\n                    history.push('/success')\r\n                } else {\r\n                    alert.error('There is some issue while payment processing')\r\n                }\r\n            }\r\n\r\n\r\n        } catch (error) {\r\n            document.querySelector('#pay_btn').disabled = false;\r\n            alert.error(error.response.data.message)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            <MetaData title={'Payment'} />\r\n\r\n            <CheckoutSteps shipping confirmOrder payment />\r\n\r\n            <div className=\"row wrapper\">\r\n                <div className=\"col-10 col-lg-5\">\r\n                    <form className=\"shadow-lg\" onSubmit={submitHandler}>\r\n                        <h1 className=\"mb-4\">Card Info</h1>\r\n                        <div className=\"form-group\">\r\n                            <label htmlFor=\"card_num_field\">Card Number</label>\r\n                            <CardNumberElement\r\n                                type=\"text\"\r\n                                id=\"card_num_field\"\r\n                                className=\"form-control\"\r\n                                options={options}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"form-group\">\r\n                            <label htmlFor=\"card_exp_field\">Card Expiry</label>\r\n                            <CardExpiryElement\r\n                                type=\"text\"\r\n                                id=\"card_exp_field\"\r\n                                className=\"form-control\"\r\n                                options={options}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"form-group\">\r\n                            <label htmlFor=\"card_cvc_field\">Card CVC</label>\r\n                            <CardCvcElement\r\n                                type=\"text\"\r\n                                id=\"card_cvc_field\"\r\n                                className=\"form-control\"\r\n                                options={options}\r\n                            />\r\n                        </div>\r\n\r\n\r\n                        <button\r\n                            id=\"pay_btn\"\r\n                            type=\"submit\"\r\n                            className=\"btn btn-block py-3\"\r\n                        >\r\n                            Pay {` - ${orderInfo && orderInfo.totalPrice}`}\r\n                        </button>\r\n\r\n                    </form>\r\n                </div>\r\n            </div>\r\n\r\n        </Fragment>\r\n    )\r\n}\r\n\r\nexport default Payment\r\n"],"mappings":"8QAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAElD,MAAO,CAAAC,QAAQ,KAAM,oBAAoB,CACzC,MAAO,CAAAC,aAAa,KAAM,iBAAiB,CAE3C,OAASC,QAAQ,KAAQ,aAAa,CACtC,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,OAASC,WAAW,CAAEC,WAAW,KAAQ,4BAA4B,CAErE,OAASC,SAAS,CAAEC,WAAW,CAAEC,iBAAiB,CAAEC,iBAAiB,CAAEC,cAAc,KAAQ,yBAAyB,CAEtH,MAAO,CAAAC,KAAK,KAAM,OAAO,QAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEzB,GAAM,CAAAC,OAAO,CAAG,CACZC,KAAK,CAAE,CACHC,IAAI,CAAE,CACFC,QAAQ,CAAE,MACd,CAAC,CACDC,OAAO,CAAE,CACLC,KAAK,CAAE,SACX,CACJ,CACJ,CAAC,CAED,GAAM,CAAAC,OAAO,CAAG,QAAV,CAAAA,OAAOA,CAAAC,IAAA,CAAoB,IAAd,CAAAC,OAAO,CAAAD,IAAA,CAAPC,OAAO,CAEtB,GAAM,CAAAC,KAAK,CAAGxB,QAAQ,EAAE,CACxB,GAAM,CAAAyB,MAAM,CAAGpB,SAAS,EAAE,CAC1B,GAAM,CAAAqB,QAAQ,CAAGpB,WAAW,EAAE,CAC9B,GAAM,CAAAqB,QAAQ,CAAG1B,WAAW,EAAE,CAE9B,IAAA2B,YAAA,CAAiB1B,WAAW,CAAC,SAAA2B,KAAK,QAAI,CAAAA,KAAK,CAACC,IAAI,GAAC,CAAzCC,IAAI,CAAAH,YAAA,CAAJG,IAAI,CACZ,IAAAC,aAAA,CAAoC9B,WAAW,CAAC,SAAA2B,KAAK,QAAI,CAAAA,KAAK,CAACI,IAAI,GAAC,CAA5DC,SAAS,CAAAF,aAAA,CAATE,SAAS,CAAEC,YAAY,CAAAH,aAAA,CAAZG,YAAY,CAC/B,IAAAC,aAAA,CAAkBlC,WAAW,CAAC,SAAA2B,KAAK,QAAI,CAAAA,KAAK,CAACQ,QAAQ,GAAC,CAA9CC,KAAK,CAAAF,aAAA,CAALE,KAAK,CAEbzC,SAAS,CAAC,UAAM,CAEZ,GAAIyC,KAAK,CAAE,CACPd,KAAK,CAACc,KAAK,CAACA,KAAK,CAAC,CAClBX,QAAQ,CAACvB,WAAW,EAAE,CAAC,CAC3B,CAEJ,CAAC,CAAE,CAACuB,QAAQ,CAAEH,KAAK,CAAEc,KAAK,CAAC,CAAC,CAE5B,GAAM,CAAAC,KAAK,CAAG,CACVC,UAAU,CAAEN,SAAS,CACrBC,YAAY,CAAZA,YACJ,CAAC,CAED,GAAM,CAAAM,SAAS,CAAGC,IAAI,CAACC,KAAK,CAACC,cAAc,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,CACjE,GAAIJ,SAAS,CAAE,CACXF,KAAK,CAACO,UAAU,CAAGL,SAAS,CAACK,UAAU,CACvCP,KAAK,CAACQ,aAAa,CAAGN,SAAS,CAACM,aAAa,CAC7CR,KAAK,CAACS,QAAQ,CAAGP,SAAS,CAACO,QAAQ,CACnCT,KAAK,CAACU,UAAU,CAAGR,SAAS,CAACQ,UAAU,CAC3C,CAEA,GAAM,CAAAC,WAAW,CAAG,CAChBC,MAAM,CAAEC,IAAI,CAACC,KAAK,CAACZ,SAAS,CAACQ,UAAU,CAAG,GAAG,CACjD,CAAC,CAED,GAAM,CAAAK,aAAa,6BAAAC,KAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAOC,CAAC,MAAAC,GAAA,CAAAC,MAAA,CAAAC,YAAA,CAAAC,MAAA,QAAAP,mBAAA,GAAAQ,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAC1BT,CAAC,CAACU,cAAc,EAAE,CAElBC,QAAQ,CAACC,aAAa,CAAC,UAAU,CAAC,CAACC,QAAQ,CAAG,IAAI,CAACN,QAAA,CAAAC,IAAA,GAKzCN,MAAM,CAAG,CACXY,OAAO,CAAE,CACL,cAAc,CAAE,kBACpB,CACJ,CAAC,CAAAP,QAAA,CAAAE,IAAA,SAEW,CAAA3D,KAAK,CAACiE,IAAI,CAAC,yBAAyB,CAAEzB,WAAW,CAAEY,MAAM,CAAC,QAAtED,GAAG,CAAAM,QAAA,CAAAS,IAAA,CAEGb,YAAY,CAAGF,GAAG,CAACgB,IAAI,CAACC,aAAa,CAE3CC,OAAO,CAACC,GAAG,CAACjB,YAAY,CAAC,CAAC,KAEtB,CAACtC,MAAM,EAAI,CAACC,QAAQ,GAAAyC,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAc,MAAA,mBAAAd,QAAA,CAAAE,IAAA,UAIH,CAAA5C,MAAM,CAACyD,kBAAkB,CAACnB,YAAY,CAAE,CACzDoB,cAAc,CAAE,CACZC,IAAI,CAAE1D,QAAQ,CAAC2D,UAAU,CAAC9E,iBAAiB,CAAC,CAC5C+E,eAAe,CAAE,CACbC,IAAI,CAAExD,IAAI,CAACwD,IAAI,CACfC,KAAK,CAAEzD,IAAI,CAACyD,KAChB,CACJ,CACJ,CAAC,CAAC,SARIxB,MAAM,CAAAG,QAAA,CAAAS,IAAA,CAUZ,GAAIZ,MAAM,CAAC1B,KAAK,CAAE,CACdd,KAAK,CAACc,KAAK,CAAC0B,MAAM,CAAC1B,KAAK,CAACmD,OAAO,CAAC,CACjClB,QAAQ,CAACC,aAAa,CAAC,UAAU,CAAC,CAACC,QAAQ,CAAG,KAAK,CACvD,CAAC,IAAM,CAEH;AACA,GAAIT,MAAM,CAAC0B,aAAa,CAACC,MAAM,GAAK,WAAW,CAAE,CAE7CpD,KAAK,CAACqD,WAAW,CAAG,CAChBC,EAAE,CAAE7B,MAAM,CAAC0B,aAAa,CAACG,EAAE,CAC3BF,MAAM,CAAE3B,MAAM,CAAC0B,aAAa,CAACC,MACjC,CAAC,CAEDhE,QAAQ,CAACxB,WAAW,CAACoC,KAAK,CAAC,CAAC,CAE5BhB,OAAO,CAACuE,IAAI,CAAC,UAAU,CAAC,CAC5B,CAAC,IAAM,CACHtE,KAAK,CAACc,KAAK,CAAC,8CAA8C,CAAC,CAC/D,CACJ,CAAC6B,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAA4B,EAAA,CAAA5B,QAAA,aAIDI,QAAQ,CAACC,aAAa,CAAC,UAAU,CAAC,CAACC,QAAQ,CAAG,KAAK,CACnDjD,KAAK,CAACc,KAAK,CAAC6B,QAAA,CAAA4B,EAAA,CAAMC,QAAQ,CAACnB,IAAI,CAACY,OAAO,CAAC,0BAAAtB,QAAA,CAAA8B,IAAA,MAAAtC,OAAA,iBAE/C,kBA5DK,CAAAL,aAAaA,CAAA4C,EAAA,SAAA3C,KAAA,CAAA4C,KAAA,MAAAC,SAAA,OA4DlB,CAED,mBACItF,KAAA,CAAClB,QAAQ,EAAAyG,QAAA,eACLzF,IAAA,CAACd,QAAQ,EAACwG,KAAK,CAAE,SAAU,EAAG,cAE9B1F,IAAA,CAACb,aAAa,EAACwG,QAAQ,MAACC,YAAY,MAACC,OAAO,OAAG,cAE/C7F,IAAA,QAAK8F,SAAS,CAAC,aAAa,CAAAL,QAAA,cACxBzF,IAAA,QAAK8F,SAAS,CAAC,iBAAiB,CAAAL,QAAA,cAC5BvF,KAAA,SAAM4F,SAAS,CAAC,WAAW,CAACC,QAAQ,CAAErD,aAAc,CAAA+C,QAAA,eAChDzF,IAAA,OAAI8F,SAAS,CAAC,MAAM,CAAAL,QAAA,CAAC,WAAS,EAAK,cACnCvF,KAAA,QAAK4F,SAAS,CAAC,YAAY,CAAAL,QAAA,eACvBzF,IAAA,UAAOgG,OAAO,CAAC,gBAAgB,CAAAP,QAAA,CAAC,aAAW,EAAQ,cACnDzF,IAAA,CAACL,iBAAiB,EACdsG,IAAI,CAAC,MAAM,CACXhB,EAAE,CAAC,gBAAgB,CACnBa,SAAS,CAAC,cAAc,CACxB3F,OAAO,CAAEA,OAAQ,EACnB,GACA,cAEND,KAAA,QAAK4F,SAAS,CAAC,YAAY,CAAAL,QAAA,eACvBzF,IAAA,UAAOgG,OAAO,CAAC,gBAAgB,CAAAP,QAAA,CAAC,aAAW,EAAQ,cACnDzF,IAAA,CAACJ,iBAAiB,EACdqG,IAAI,CAAC,MAAM,CACXhB,EAAE,CAAC,gBAAgB,CACnBa,SAAS,CAAC,cAAc,CACxB3F,OAAO,CAAEA,OAAQ,EACnB,GACA,cAEND,KAAA,QAAK4F,SAAS,CAAC,YAAY,CAAAL,QAAA,eACvBzF,IAAA,UAAOgG,OAAO,CAAC,gBAAgB,CAAAP,QAAA,CAAC,UAAQ,EAAQ,cAChDzF,IAAA,CAACH,cAAc,EACXoG,IAAI,CAAC,MAAM,CACXhB,EAAE,CAAC,gBAAgB,CACnBa,SAAS,CAAC,cAAc,CACxB3F,OAAO,CAAEA,OAAQ,EACnB,GACA,cAGND,KAAA,WACI+E,EAAE,CAAC,SAAS,CACZgB,IAAI,CAAC,QAAQ,CACbH,SAAS,CAAC,oBAAoB,CAAAL,QAAA,EACjC,MACO,OAAAS,MAAA,CAAOrE,SAAS,EAAIA,SAAS,CAACQ,UAAU,IACvC,GAEN,EACL,EACJ,GAEC,CAEnB,CAAC,CAED,cAAe,CAAA5B,OAAO"},"metadata":{},"sourceType":"module"}